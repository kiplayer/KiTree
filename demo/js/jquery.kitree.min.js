/*
 ### Ki Tree Plugin v1.0.1 - 2016-06-11 ###
 * Home: http://kiplayer.vps.phps.kr/kitree/
 * Licensed under http://en.wikipedia.org/wiki/MIT_License
 ###
*/
function treeBegin(e,t,r){or_y=r}function treeDrag(e,t,r){or_el_move=e,$(e).addClass("move");var a=$(e).parents(".kiTree"),n=a.find(".dragTreeItem"),o=a.find("a"),i=a.scrollTop(),l=a.height();if(i>r?a.scrollTop(i-50):r>i+l-24&&a.scrollTop(i+50),movePx=or_y-r,movePx>-18&&movePx<=18)$(e).empty(),o.css("border-color","#fff");else if(movePx>18&&movePx<30)o.css("border-color","#fff"),$(e).html("+&nbsp;&nbsp;&nbsp;");else{$(e).empty();for(var s=0;s<n.length;s++){if($(e).offset().top<n.eq(s).offset().top){gap=Math.abs($(e).offset().top-n.eq(curr_no).offset().top),n.eq(curr_no).attr("id")!=$(e).attr("id")&&(0!=$(e).parent("a").parent("li").find("#"+n.eq(curr_no).attr("id")).length||(gap<6?($(e).empty(),o.css("border-color","#fff"),$(e).html("+&nbsp;&nbsp;&nbsp;")):($(e).empty(),o.css("border-color","#fff"),n.eq(curr_no).parent("a").css("border-color","#bbb"))));break}n.eq(s).offset().top>0&&(curr_no=s)}$(e).offset().top<n.eq(curr_no).offset().top+6?(o.css("border-color","#fff"),$(e).html("+&nbsp;&nbsp;&nbsp;")):s==n.length&&($(e).empty(),o.css("border-color","#fff"),n.eq(curr_no).parent("a").css("border-color","#bbb"))}}function treeEnd(e,t,r){var a=$(e).parents(".kiTree"),n=$(e).parent("a").parent("li"),o=parseInt(a.attr("data-maxDepth")),i=(a.attr("data-rootDenied"),a.parents("ul").length),l=0,s=$(e).attr("id").replace("dragItem_",""),d=0;n.find("ul").length>0&&(d++,n.find("ul li ul").length>0&&(d++,n.find("ul li ul li ul").length>0&&(d++,n.find("ul li ul li ul li ul").length>0&&d++)));var p,f,c,h,g=!1;if(or_el_move!=e)window.location.href=$(e).parent("a").attr("href");else if(dragItem=$(".dragTreeItem"),movePx>-18&&movePx<=18);else if(movePx>18&&movePx<30){for(var u=0;u<dragItem.length;u++)if($(e).offset().top<dragItem.eq(u).offset().top+10){f=dragItem.eq(l).parents("ul").length-i,totalLevel=d+f,totalLevel<o?(c=dragItem.eq(u).attr("id").replace("dragItem_",""),h="in"):(e.style.top=or_y+"px",alert("Max "+o),g=!0);break}}else{for(var u=0;u<dragItem.length;u++){if($(e).offset().top<dragItem.eq(u).offset().top){gap=Math.abs($(e).offset().top-dragItem.eq(l).offset().top),p!=s&&(0!=n.find("#dragItem_"+p).length?(e.style.left=or_y+"px",alert("Can not move to the inside."),g=!0):(f=dragItem.eq(l).parents("ul").length-i,totalLevel=d+f,gap<6?totalLevel<o?(c=dragItem.eq(l).attr("id").replace("dragItem_",""),h="in"):(e.style.left=or_y+"px",alert("Max "+o+"Step."),g=!0):$("#dragItem_"+p).parent().parent().children("ul").length>0&&"none"!=$("#dragItem_"+p).parent().parent().children("ul").css("display")&&totalLevel<o+1?(c=p,h="firstin"):n.parent().parent().hasClass("kiTree")||1!=f?totalLevel<o+1?(c=dragItem.eq(l).attr("id").replace("dragItem_",""),h="move"):(e.style.left=or_y+"px",alert("Max "+o+"Step."),g=!0):(e.style.left=or_y+"px",alert("Step 1 can not be moved."),g=!0)));break}dragItem.eq(u).offset().top>0&&(l=u,p=dragItem.eq(l).attr("id").replace("dragItem_",""))}$(e).offset().top<dragItem.eq(l).offset().top+6?(dragItem.eq(l).attr("id")==$(e).attr("id")&&(l+=1),c=dragItem.eq(l).attr("id").replace("dragItem_",""),h="in"):u==dragItem.length&&(dragItem.eq(l).parent().parent().parent().parent().hasClass("treeWrap")?(e.style.left=or_y+"px",alert("Step 1 can not be moved."),g=!0):(c=dragItem.eq(l).attr("id").replace("dragItem_",""),h="move"))}if($(a).kiTree("lineup"),c&&0==g){var m={element:e,dragId:s,targetId:c,move:h};$(a).kiTree("dragMove",m)}$(e).removeClass("move"),$(e).empty(),$(a).find("li a").css("border-color","#fff")}window.jQuery&&function($){var kiTree_dragSuccess,kiTree_kiplayer;$.fn.kiTree=function(options){function jsonUlAdd(e){if(e.length>0)for(var t=$("<ul></ul>"),r=0;r<e.length;r++){var a=$("<li></li>"),n=$('<a href="'+e[r].url+'">'+e[r].name+"</a>");if(a.append(n),e[r].list&&e[r].list.length>0){var o=jsonUlAdd(e[r].list);a.append(o)}t.append(a)}return t}if(0==this.length)return this;if("string"==typeof arguments[0]){if(this.length>1){var args=arguments;return this.each(function(){$.fn.kiTree.apply($(this),args)})}return $.fn.kiTree[arguments[0]].apply(this,$.makeArray(arguments).slice(1)||[])}var options=$.extend({},$.fn.kiTree.options,options||{});this.not(".kiTree").addClass("kiTree").each(function(){window.kiTree=(window.kiTree||0)+1;var group_count=window.kiTree,kiTree={e:this,E:$(this),clone:$(this).clone()},o=$.extend({},$.fn.kiTree.options,options||{},($.metadata?kiTree.E.metadata():$.meta?kiTree.E.data():null)||{},{});if($.extend(kiTree,o||{}),kiTree.STRING=$.extend({},$.fn.kiTree.options.STRING,kiTree.STRING),parseInt(o.width)>0&&$(this).width(o.width),parseInt(o.height)>0&&$(this).height(o.height),o.bordered&&$(this).not(".bordered").addClass("bordered"),o.useCheckbox&&$(this).not(".useCheckbox").addClass("useCheckbox"),$(this).attr("data-maxDepth",o.maxDepth),o.rootDenied&&$(this).attr("data-rootDenied",o.rootDenied),o.dragSuccess&&(kiTree_dragSuccess=o.dragSuccess),"object"==typeof o.data){var treeWrap=$(this),treeHtml=jsonUlAdd(o.data);treeWrap.append(treeHtml)}$.extend(kiTree,{n:0,trees:[],trigger:function(e,t,r,a){var n,o=r[e]||r["on"+e];return o?(a=a||r.files||FILE_LIST(this),$.each(a,function(e,a){n=o.apply(r.wrapper,[t,a.name,r,a])}),n):void 0}}),kiTree.init=function(tree){tree.kiTree=kiTree;for(var tree=$(tree),treeLiList=tree.find("li"),i=0;i<treeLiList.length;i++){var treeLi=treeLiList.eq(i),em=$("<em></em>").click(function(){if($(this).hasClass("on")||$(this).hasClass("off")){var e=$(this).parent().children("ul");"none"==e.css("display")?($(this).attr("class","on"),e.removeClass("hidden")):($(this).attr("class","off"),e.addClass("hidden"))}$(kiTree.e).reset()}),sup="";if(o.useCount&&(sup=$("<sup></sup>")),treeLi.prepend(em.append(sup)),o.useCheckbox){var span=$('<span class="checkBox"></span>'),checkbox=$('<input type="checkbox" name="" value="">').click(function(){var e=$(this).parent().parent(),t=$(this).parent().parent().parent();if(1==$(this).prop("checked")){e.find("input[type='checkbox']").prop("checked",!0);for(var r=0;r<e.find("em.off").length;r++){var a=e.find("em.off").eq(r);a.attr("class","on"),a.parent().children("ul").removeClass("hidden")}for(var n=!0,r=0;r<t.find("input[type='checkbox']").length;r++){var o=t.find("input[type='checkbox']").eq(r);if(0==o.prop("checked")){n=!1;break}}1==n&&t.parent().children("span.checkBox").children("input").prop("checked",!0)}else{e.find("input[type='checkbox']").prop("checked",!1);var n=!0;t.parent().children("span.checkBox").children("input").prop("checked",!1)}});treeLi.prepend(span.append(checkbox))}}if(o.useDrag){for(var treeNo=kiTree.n,treeLiList=tree.find("li"),i=0;i<treeLiList.length;i++)treeLiList.eq(i).children("a").append('<div id="dragItem_'+treeNo+"_"+i+'" class="dragTreeItem"></div>'),eval("var dragItem_"+treeNo+"_"+i+" = treeDragHandler.attach(document.getElementById('dragItem_"+treeNo+"_"+i+"'));dragItem_"+treeNo+"_"+i+".dragBegin = treeBegin;dragItem_"+treeNo+"_"+i+".drag = treeDrag;dragItem_"+treeNo+"_"+i+".dragEnd = treeEnd;"),treeLiList.eq(i).children("em").click(function(){$(kiTree.e).kiTree("lineup")});$(kiTree.e).kiTree("lineup")}$(kiTree.e).kiTree("reset")},kiTree.kiTree||kiTree.init(kiTree.e)})},$.extend($.fn.kiTree,{reset:function(){for(var e=$(this),t=e.find("li"),r=0;r<t.length;r++){var a=t.eq(r),n=a.children("ul"),o=a.children("em");if(o.removeAttr("class"),0==n.length)o.addClass("none");else{if(o.children("sup").length>0){var i=o.children("sup");i.show().text(n.find("li").length)}"none"==n.css("display")?o.addClass("off"):o.addClass("on")}}},lineup:function(){var e=$(this);_scrollTop=e.scrollTop(),dragItem=e.find(".dragTreeItem");for(var t=0;t<dragItem.length;t++)dragItem.eq(t).css("top",dragItem.eq(t).parent("a").offset().top-e.offset().top+_scrollTop+"px");treeLiItem=e.find("li");for(var t=0;t<treeLiItem.length;t++)0==treeLiItem.eq(t).find("li").length&&(treeLiItem.eq(t).children("em").removeClass().addClass("none"),treeLiItem.eq(t).children("ul").remove());$(e).kiTree("reset")},dragMove:function(e){var t=$(this);if(kiTree_dragSuccess(e)){var r=e.element,a=(e.dragId,e.targetId),n=e.move,o=$("#dragItem_"+a).parent("a").parent("li"),i=$(r).parent("a").parent("li");"in"==n?(0==o.children("ul").length?(o.children("em").removeAttr("class").addClass("on"),o.append("<ul></ul>")):(o.children("em").removeAttr("class").addClass("on"),o.children("ul").show()),o.children("ul").append(i)):"firstin"==n?o.find("li").eq(0).before(i):"move"==n&&o.after(i)}$(t).kiTree("lineup")},search:function(e){var t=$(this),r=t.find("a");if(t.attr("data-keyword")!=e){t.attr("data-keyword",e),t.attr("data-keyword-count",0);for(var a=0,n=0;n<r.length;n++){var o=r.eq(n);if(o.html(o.html().replace('<b class="keyword">',"").replace("</b>","")),-1!=o.text().indexOf(e)){if(a++,1==a){var i=t.scrollTop()+o.offset().top-t.offset().top;t.scrollTop(i)}o.html(o.html().replace(e,'<b class="keyword">'+e+"</b>"))}}t.attr("data-keyword-length",a)}else{var l=t.attr("data-keyword-count"),s=t.attr("data-keyword-length");if(l++,l==s&&(l=0),s>l){t.attr("data-keyword-count",l);for(var a=0,n=0;n<r.length;n++){var o=r.eq(n);if(-1!=o.text().indexOf(e)){if(l==a){var i=t.scrollTop()+o.offset().top-t.offset().top;t.scrollTop(i);break}a++}}}}}}),$.fn.kiTree.options={width:0,height:0,bordered:!1,useCount:!1,useCheckbox:!1,useDrag:!1,maxDepth:10,errorMsg:{max:"error max",denied:"error denied"},error:function(e){"undefined"!=typeof console&&console.log(e),alert(e)},dragSuccess:function(e,t,r,a,n){}},$.fn.reset=$.fn.reset||function(){return this.each(function(){try{this.reset()}catch(e){}})},$.fn.lineup=$.fn.lineup||function(){return this.each(function(){try{this.lineup()}catch(e){}})}}(jQuery);var or_y,or_el_move,treeDragHandler={_oElem:null,attach:function(e){return e.onmousedown=treeDragHandler._dragBegin,e.dragBegin=new Function,e.drag=new Function,e.dragEnd=new Function,e},_dragBegin:function(e){var t=treeDragHandler._oElem=this;isNaN(parseInt(t.style.left))&&(t.style.left="0px"),isNaN(parseInt(t.style.top))&&(t.style.top="0px");var r=parseInt(t.style.left),a=parseInt(t.style.top);return e=e?e:window.event,t.mouseX=e.clientX,t.mouseY=e.clientY,t.dragBegin(t,r,a),document.onmousemove=treeDragHandler._drag,document.onmouseup=treeDragHandler._dragEnd,!1},_drag:function(e){var t=treeDragHandler._oElem,r=parseInt(t.style.left),a=parseInt(t.style.top);e=e?e:window.event;var n=a+(e.clientY-t.mouseY);return 0>n&&(n=0),t.style.top=n+"px",t.style.left=0,t.mouseX=e.clientX,t.mouseY=e.clientY,t.drag(t,r,a),!1},_dragEnd:function(){var e=treeDragHandler._oElem,t=parseInt(e.style.left),r=parseInt(e.style.top);e.dragEnd(e,t,r),document.onmousemove=null,document.onmouseup=null,treeDragHandler._oElem=null}};